// Proton Feed — reads data/proton_feed.json
// This file should be generated by an automation that mirrors the latest thread (see notes below)


const ProtonFeed = (() => {
function renderItem(feedRoot, item) {
const el = document.createElement('article');
el.className = 'feed-item';
const date = new Date(item.date || item.timestamp || Date.now());
el.innerHTML = `
<div class="meta"><span>${item.from || 'Anonymous'}</span> • <time>${date.toLocaleString()}</time></div>
<div class="subj"><strong>${item.subject || '(no subject)'}</strong></div>
<div class="body">${(item.snippet || item.body || '').slice(0, 500)}</div>
`;
feedRoot.appendChild(el);
}


return {
async render(selector, config={}) {
const host = document.querySelector(selector);
const limit = config.maxItems || 10;
try {
const data = await (await fetch('data/proton_feed.json', { cache: 'no-store' })).json();
const items = (data.items || data || []).slice(0, limit);
if (!items.length) host.innerHTML = '<div class="muted">No messages yet.</div>';
items.forEach(i => renderItem(host, i));
} catch (e) {
host.innerHTML = '<div class="muted">Unable to load feed.</div>';
console.warn(e);
}
}
};
})();
